<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pick the Shapes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2C3E50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .score-item {
            background: #ECF0F1;
            padding: 12px 25px;
            border-radius: 20px;
        }

        .instruction {
            text-align: center;
            font-size: 2em;
            color: #2C3E50;
            margin-bottom: 30px;
            font-weight: bold;
            padding: 20px;
            background: #FFF9E6;
            border-radius: 20px;
            border: 3px solid #F39C12;
        }

        .shapes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 40px 0;
            padding: 20px;
            background: #F8F9FA;
            border-radius: 20px;
        }

        .shape-item {
            aspect-ratio: 1;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            position: relative;
            border: 4px solid transparent;
        }

        .shape-item:hover {
            transform: scale(1.1);
        }

        .shape-item.selected {
            border: 4px solid #FFD700;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .shape-item.correct {
            border: 4px solid #27AE60;
            animation: correctPulse 0.5s;
        }

        .shape-item.wrong {
            border: 4px solid #E74C3C;
            animation: shake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shape {
            position: relative;
        }

        .circle-shape {
            border-radius: 50%;
        }

        .square-shape {
            border-radius: 5px;
        }

        .rectangle-shape {
            border-radius: 5px;
        }

        .triangle-shape {
            width: 0;
            height: 0;
            border-style: solid;
            border-left-color: transparent !important;
            border-right-color: transparent !important;
            border-top-color: transparent !important;
        }

        .feedback {
            text-align: center;
            font-size: 1.8em;
            margin: 20px 0;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback.correct {
            color: #27AE60;
        }

        .feedback.wrong {
            color: #E74C3C;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0px;
            margin-top: 30px;
        }

        .check-btn {
            background: #F39C12;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.6em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-family: Arial, Helvetica, sans-serif;
            margin-bottom: 15px;
        }

        .check-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            background: #E67E22;
        }

        .check-btn:disabled {
            background: #95A5A6;
            cursor: not-allowed;
            transform: none;
        }

        .try-again-btn {
            background: #E67E22;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.6em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-family: Arial, Helvetica, sans-serif;
            margin-bottom: 15px;
        }

        .try-again-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            background: #D35400;
        }

        .next-btn {
            background: #2ECC71;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.6em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-family: Arial, Helvetica, sans-serif;
            margin-bottom: 15px;
        }

        .next-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            background: #27AE60;
        }

        .btn-home {
            background: #9B59B6;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-family: Arial, Helvetica, sans-serif;
        }

        .btn-home:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8em;
            animation: celebrate 0.8s;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.3) rotate(180deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .instruction {
                font-size: 1.4em;
                padding: 15px;
            }

            .shapes-grid {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 15px;
            }

            .score-board {
                font-size: 1em;
                gap: 15px;
            }

            .check-btn, .try-again-btn, .next-btn {
                padding: 15px 40px;
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî∑ Pick the Shapes</h1>

        <div class="score-board">
            <div class="score-item">
                Challenge: <span id="challengeNum">1</span> / 8
            </div>
            <div class="score-item">
                Score: <span id="score">0</span>
            </div>
        </div>

        <div class="instruction" id="instruction"></div>

        <div class="shapes-grid" id="shapesGrid"></div>

        <div class="feedback" id="feedback"></div>

        <div class="controls">
            <button class="check-btn" id="checkBtn" onclick="checkAnswer()" disabled>Check Answer</button>
            <button class="try-again-btn" id="tryAgainBtn" onclick="tryAgain()" style="display: none;">üîÑ Try Again</button>
            <button class="next-btn" id="nextBtn" onclick="nextChallenge()" style="display: none;">Next ‚û°Ô∏è</button>
        </div>

        <button class="btn-home" onclick="window.location.href='../grade-1-math-index.html'">üè† Home</button>
    </div>

    <script>
        const colors = {
            red: '#E74C3C',
            blue: '#3498DB',
            yellow: '#F1C40F',
            green: '#2ECC71',
            orange: '#E67E22',
            purple: '#9B59B6'
        };

        const challenges = [
            { shape: 'circle', color: 'red', count: 3 },
            { shape: 'square', color: 'blue', count: 3 },
            { shape: 'rectangle', color: 'yellow', count: 3 },
            { shape: 'triangle', color: 'green', count: 3 },
            { shape: 'circle', color: 'blue', count: 4 },
            { shape: 'square', color: 'red', count: 4 },
            { shape: 'rectangle', color: 'green', count: 4 },
            { shape: 'triangle', color: 'purple', count: 4 }
        ];

        let currentChallenge = 0;
        let score = 0;
        let selectedShapes = [];
        let correctShapes = [];
        let hasChecked = false;

        function speak(text) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.85;
                utterance.pitch = 1.1;
                utterance.volume = 1;
                speechSynthesis.speak(utterance);
            }
        }

        function createShape(shape, color, size) {
            const div = document.createElement('div');
            div.className = 'shape';
            
            if (shape === 'circle') {
                div.style.width = size + 'px';
                div.style.height = size + 'px';
                div.style.backgroundColor = color;
                div.classList.add('circle-shape');
            } else if (shape === 'square') {
                div.style.width = size + 'px';
                div.style.height = size + 'px';
                div.style.backgroundColor = color;
                div.classList.add('square-shape');
            } else if (shape === 'rectangle') {
                div.style.width = (size * 1.5) + 'px';
                div.style.height = size + 'px';
                div.style.backgroundColor = color;
                div.classList.add('rectangle-shape');
            } else if (shape === 'triangle') {
                div.classList.add('triangle-shape');
                div.style.borderLeft = (size/2) + 'px solid transparent';
                div.style.borderRight = (size/2) + 'px solid transparent';
                div.style.borderBottom = (size * 0.87) + 'px solid ' + color;
            }
            
            return div;
        }

        function loadChallenge() {
            if (currentChallenge >= challenges.length) {
                showFinalScore();
                return;
            }

            hasChecked = false;
            selectedShapes = [];
            correctShapes = [];

            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('checkBtn').style.display = 'block';
            document.getElementById('tryAgainBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';

            const challenge = challenges[currentChallenge];
            document.getElementById('challengeNum').textContent = currentChallenge + 1;

            const instruction = document.getElementById('instruction');
            instruction.textContent = `Pick all the ${challenge.color} ${challenge.shape}s`;

            // Generate shapes
            const totalShapes = 12;
            const shapes = ['circle', 'square', 'rectangle', 'triangle'];
            const colorKeys = Object.keys(colors);
            const allShapes = [];

            // Add correct shapes
            for (let i = 0; i < challenge.count; i++) {
                allShapes.push({
                    shape: challenge.shape,
                    color: colors[challenge.color],
                    colorName: challenge.color,
                    isCorrect: true
                });
            }

            // Add wrong shapes (different shape or different color)
            while (allShapes.length < totalShapes) {
                const wrongShapeType = shapes[Math.floor(Math.random() * shapes.length)];
                const wrongColorName = colorKeys[Math.floor(Math.random() * colorKeys.length)];
                const wrongColor = colors[wrongColorName];
                
                // Make sure it's not the target combination
                if (!(wrongShapeType === challenge.shape && wrongColorName === challenge.color)) {
                    allShapes.push({
                        shape: wrongShapeType,
                        color: wrongColor,
                        colorName: wrongColorName,
                        isCorrect: false
                    });
                }
            }

            // Shuffle
            allShapes.sort(() => Math.random() - 0.5);

            // Display shapes
            const grid = document.getElementById('shapesGrid');
            grid.innerHTML = '';

            allShapes.forEach((item, index) => {
                const container = document.createElement('div');
                container.className = 'shape-item';
                container.dataset.index = index;
                container.dataset.correct = item.isCorrect;
                
                const size = 60 + Math.random() * 30;
                const shapeDiv = createShape(item.shape, item.color, size);
                container.appendChild(shapeDiv);
                
                container.onclick = () => toggleShape(index);
                grid.appendChild(container);

                if (item.isCorrect) {
                    correctShapes.push(index);
                }
            });

            speak(`Pick all the ${challenge.color} ${challenge.shape}s`);
        }

        function toggleShape(index) {
            if (hasChecked) return;

            const item = document.querySelector(`[data-index="${index}"]`);
            
            if (selectedShapes.includes(index)) {
                selectedShapes = selectedShapes.filter(i => i !== index);
                item.classList.remove('selected');
            } else {
                selectedShapes.push(index);
                item.classList.add('selected');
            }

            document.getElementById('checkBtn').disabled = selectedShapes.length === 0;
        }

        function checkAnswer() {
            if (hasChecked) return;
            hasChecked = true;

            const sortedSelected = [...selectedShapes].sort();
            const sortedCorrect = [...correctShapes].sort();
            const isCorrect = JSON.stringify(sortedSelected) === JSON.stringify(sortedCorrect);

            const feedback = document.getElementById('feedback');

            // Show visual feedback
            const allItems = document.querySelectorAll('.shape-item');
            allItems.forEach(item => {
                const index = parseInt(item.dataset.index);
                const isCorrectItem = correctShapes.includes(index);
                const isSelected = selectedShapes.includes(index);

                if (isCorrectItem && isSelected) {
                    item.classList.add('correct');
                } else if (!isCorrectItem && isSelected) {
                    item.classList.add('wrong');
                } else if (isCorrectItem && !isSelected) {
                    item.classList.add('wrong');
                }
            });

            if (isCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                feedback.textContent = 'üéâ Perfect! All correct!';
                feedback.className = 'feedback correct';
                speak('Perfect! All correct!');
                showCelebration('‚≠ê');

                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('tryAgainBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'block';
            } else {
                feedback.textContent = '‚ùå Not quite right. Try again!';
                feedback.className = 'feedback wrong';
                speak('Not quite right. Try again!');

                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('tryAgainBtn').style.display = 'block';
                document.getElementById('nextBtn').style.display = 'none';
            }
        }

        function tryAgain() {
            loadChallenge();
        }

        function nextChallenge() {
            currentChallenge++;
            loadChallenge();
        }

        function showCelebration(emoji) {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = emoji;
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 800);
        }

        function showFinalScore() {
            const container = document.querySelector('.container');
            const percentage = Math.round((score / challenges.length) * 100);
            
            let message = '';
            let emoji = '';
            
            if (percentage === 100) {
                message = 'Outstanding!';
                emoji = 'üèÜ';
            } else if (percentage >= 80) {
                message = 'Excellent work!';
                emoji = 'üåü';
            } else if (percentage >= 60) {
                message = 'Good job!';
                emoji = 'üëç';
            } else {
                message = 'Keep practicing!';
                emoji = 'üí™';
            }

            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 5em; margin-bottom: 20px;">${emoji}</div>
                    <h2 style="font-size: 2.5em; color: #2C3E50; margin-bottom: 20px;">${message}</h2>
                    <div style="font-size: 2em; color: #667eea; margin-bottom: 20px;">
                        You completed all challenges!
                    </div>
                    <div style="font-size: 2em; color: #3498DB; margin-bottom: 20px;">
                        Final Score: <span style="color: #F39C12; font-weight: bold;">${score}</span> / ${challenges.length}
                    </div>
                    <button class="next-btn" onclick="location.reload()" style="margin-top: 30px;">
                        üîÑ Play Again
                    </button>
                    <br><br>
                    <button class="btn-home" onclick="window.location.href='../grade-1-math-index.html'">üè† Home</button>
                </div>
            `;
            speak(`${message} You scored ${score} out of ${challenges.length}`);
        }

        // Initialize
        loadChallenge();
    </script>
</body>
</html>
